From 1372cd533e19a47a367ea1a7b69bc5c512dbe7b5 Mon Sep 17 00:00:00 2001
From: shucheng <shucheng@bd-apaas.com>
Date: Sat, 8 Jul 2023 22:49:17 +0800
Subject: [PATCH] awecloud-devops

---
 package.json                                  |  2 +-
 src/_constants/index.js                       |  2 +-
 src/app.jsx                                   | 32 +++++++++----------
 .../pages/build/graph-view/graph-view.jsx     |  4 +--
 .../build/log-view/stage-nav/stage-nav.jsx    |  4 +--
 .../pages/home/repos-recent/repos-recent.jsx  |  2 +-
 src/components/pages/home/repos/repos.jsx     |  7 ++--
 src/components/shared/activity/simple.jsx     |  2 +-
 src/components/shared/header/header.jsx       |  6 ++--
 src/components/shared/sidebar/sidebar.jsx     |  8 ++---
 src/hooks/swr/builds.js                       | 16 +++++-----
 src/hooks/swr/cards.js                        |  2 +-
 src/hooks/swr/logs.js                         |  4 +--
 src/hooks/swr/repo.js                         |  2 +-
 src/hooks/swr/use-branches.js                 |  2 +-
 src/hooks/swr/use-crons.js                    |  2 +-
 src/hooks/swr/use-deployments.js              |  2 +-
 src/hooks/swr/use-secrets.js                  |  2 +-
 src/pages/account/account.jsx                 |  2 +-
 src/pages/branches/branches.jsx               |  2 +-
 src/pages/build/build.jsx                     | 20 ++++++------
 src/pages/build/header/header.jsx             |  4 +--
 src/pages/builds/builds.jsx                   |  2 +-
 src/pages/builds/summary/summary.jsx          |  2 +-
 src/pages/deployments/deployments.jsx         |  2 +-
 src/pages/login/login.jsx                     |  2 +-
 src/pages/not-found/not-found.jsx             |  2 +-
 src/pages/repo/repo.jsx                       | 30 ++++++++---------
 src/pages/settings-admin/settings-admin.jsx   |  8 ++---
 src/pages/settings/cron/cron.jsx              |  4 +--
 src/pages/settings/general/general.jsx        |  4 +--
 src/pages/settings/secrets/secrets.jsx        |  4 +--
 src/pages/settings/settings.jsx               | 26 +++++++--------
 src/pages/welcome/welcome.jsx                 |  6 ++--
 src/routes/route-guard.jsx                    |  2 +-
 35 files changed, 113 insertions(+), 110 deletions(-)

diff --git a/package.json b/package.json
index c68e818..6eb2644 100644
--- a/package.json
+++ b/package.json
@@ -5,7 +5,7 @@
   "scripts": {
     "start": "react-scripts start",
     "build": "GENERATE_SOURCEMAP=false react-scripts build",
-    "postbuild": "rm -rf ./dist/files; mv ./build ./dist/files",
+    "postbuild": "rm -rf ./dist/files; mkdir -p ./dist/files/awecloud; mv ./build ./dist/files/awecloud/devops",
     "serve": "npx http-server ./build -p 3001",
     "test": "react-scripts test",
     "eject": "react-scripts eject",
diff --git a/src/_constants/index.js b/src/_constants/index.js
index 3163675..3de2ac7 100644
--- a/src/_constants/index.js
+++ b/src/_constants/index.js
@@ -3,7 +3,7 @@ const token = process.env.REACT_APP_DRONE_TOKEN || '';
 
 // default server address.
 const instance = process.env.REACT_APP_DRONE_SERVER
- || `${window.location.protocol}//${window.location.host}`;
+ || `${window.location.protocol}//${window.location.host}/awecloud/devops`;
 
 const LOGS_LIMIT = 250;
 
diff --git a/src/app.jsx b/src/app.jsx
index 6a785f2..817dfef 100644
--- a/src/app.jsx
+++ b/src/app.jsx
@@ -51,8 +51,8 @@ export default function App() {
               <Layouts.Base>
                 <Switch>
                   <Redirect from="/:url*(/+)" to={pathname.slice(0, -1)} />
-                  <Route path={['/welcome', '/login/form', '/login/error', '/logout', '/register']} exact />
-                  <Route path={['/settings*']} exact>
+                  <Route path={['/awecloud/devops/welcome', '/awecloud/devops/login/form', '/awecloud/devops/login/error', '/awecloud/devops/logout', '/awecloud/devops/register']} exact />
+                  <Route path={['/awecloud/devops/settings*']} exact>
                     <Sidebar user={user} />
                   </Route>
                   <Route path={'/*'}>
@@ -63,7 +63,7 @@ export default function App() {
 
                 <Switch>
                   <Routes.Home
-                    path="/"
+                    path="/awecloud/devops/"
                     componentProps={{
                       user,
                     }}
@@ -71,33 +71,33 @@ export default function App() {
                     exact
                   />
                   <Routes.Welcome
-                    path="/welcome"
+                    path="/awecloud/devops/welcome"
                     componentProps={{
                       user,
                     }}
                     exact
                   />
                   <Routes.Register
-                    path="/register"
+                    path="/awecloud/devops/register"
                     componentProps={{
                       user,
                     }}
                     exact
                   />
                   <Routes.LoginForm
-                    path="/login/form"
+                    path="/awecloud/devops/login/form"
                     exact
                   />
                   <Routes.LoginError
-                    path="/login/error"
+                    path="/awecloud/devops/login/error"
                     exact
                   />
                   <Routes.Logout
-                    path="/logout"
+                    path="/awecloud/devops/logout"
                     exact
                   />
                   <Routes.Account
-                    path="/account"
+                    path="/awecloud/devops/account"
                     componentProps={{
                       user,
                     }}
@@ -106,7 +106,7 @@ export default function App() {
                   />
                   {/* contains nested routes */}
                   <Routes.SettingsAdmin
-                    path="/settings*"
+                    path="/awecloud/devops/settings*"
                     componentProps={{
                       user,
                     }}
@@ -116,12 +116,12 @@ export default function App() {
                   {/* contains nested routes */}
                   <Routes.Repo
                     path={[
-                      '/:namespace/:name',
-                      '/:namespace/:name/deployments',
-                      '/:namespace/:name/branches',
-                      '/:namespace/:name/settings*',
-                      '/:namespace/:name/:build',
-                      '/:namespace/:name/:build/:stage?/:step?']}
+                      '/awecloud/devops/:namespace/:name',
+                      '/awecloud/devops/:namespace/:name/deployments',
+                      '/awecloud/devops/:namespace/:name/branches',
+                      '/awecloud/devops/:namespace/:name/settings*',
+                      '/awecloud/devops/:namespace/:name/:build',
+                      '/awecloud/devops/:namespace/:name/:build/:stage?/:step?']}
                     componentProps={{
                       user,
                     }}
diff --git a/src/components/pages/build/graph-view/graph-view.jsx b/src/components/pages/build/graph-view/graph-view.jsx
index a12e09f..ae9b9e3 100644
--- a/src/components/pages/build/graph-view/graph-view.jsx
+++ b/src/components/pages/build/graph-view/graph-view.jsx
@@ -27,12 +27,12 @@ const GraphView = (props) => {
   const showStepInfoDrawer = () => setIsStepInfoShown(true);
 
   const stageSelectHandler = (selectedStage) => {
-    history.replace(`/${namespace}/${name}/${build}/${selectedStage}/1`);
+    history.replace(`/awecloud/devops/${namespace}/${name}/${build}/${selectedStage}/1`);
   };
 
   const stepSelectHandler = (selectedStep) => {
     showStepInfoDrawer();
-    history.replace(`/${namespace}/${name}/${build}/${stage}/${selectedStep}`);
+    history.replace(`/awecloud/devops/${namespace}/${name}/${build}/${stage}/${selectedStep}`);
   };
 
   return (
diff --git a/src/components/pages/build/log-view/stage-nav/stage-nav.jsx b/src/components/pages/build/log-view/stage-nav/stage-nav.jsx
index 74f8a5d..dd3eceb 100644
--- a/src/components/pages/build/log-view/stage-nav/stage-nav.jsx
+++ b/src/components/pages/build/log-view/stage-nav/stage-nav.jsx
@@ -148,7 +148,7 @@ const StageDefault = (props) => {
                 const isStepInPath = !!location.pathname.split('/')[4];
                 return (match || (stageNumber === stageInPath && !isStepInPath));
               }}
-              to={`/${namespace}/${name}/${build}/${stageNumber}/${stepNumber}`}
+              to={`/awecloud/devops/${namespace}/${name}/${build}/${stageNumber}/${stepNumber}`}
               title={stepName}
               exact
               onClick={onStepClick}
@@ -180,7 +180,7 @@ const StageEmpty = (props) => {
     <NavLink
       activeClassName={cx('stage-active')}
       className={cx('stage')}
-      to={`/${namespace}/${name}/${build}/${stageNumber}`}
+      to={`/awecloud/devops/${namespace}/${name}/${build}/${stageNumber}`}
       exact
     >
       <h3 className={cx('stage-header')}>
diff --git a/src/components/pages/home/repos-recent/repos-recent.jsx b/src/components/pages/home/repos-recent/repos-recent.jsx
index 982b9f6..a9eb153 100644
--- a/src/components/pages/home/repos-recent/repos-recent.jsx
+++ b/src/components/pages/home/repos-recent/repos-recent.jsx
@@ -19,7 +19,7 @@ const ReposRecent = (props) => {
       {!!repos?.length && props.repos.map(({
         namespace, name, build, id,
       }) => (
-        <Link to={`/${namespace}/${name}`} key={id}>
+        <Link to={`/awecloud/devops/${namespace}/${name}`} key={id}>
           <div className={cx('card')}>
             <div className={cx('header')}>
               <h3 className={cx('title')}>
diff --git a/src/components/pages/home/repos/repos.jsx b/src/components/pages/home/repos/repos.jsx
index 67dea80..85f123c 100644
--- a/src/components/pages/home/repos/repos.jsx
+++ b/src/components/pages/home/repos/repos.jsx
@@ -20,7 +20,7 @@ const Repos = (props) => {
           namespace, name, id, build, active, slug,
         }) => (
           <Link
-            to={`/${namespace}/${name}${active ? '' : '/settings'}`}
+            to={`/awecloud/devops/${namespace}/${name}${active ? '' : '/settings'}`}
             key={id}
           >
             <div className={cx('item', build ? null : 'inactive')}>
@@ -31,9 +31,11 @@ const Repos = (props) => {
               <div className={cx('detail')}>
                 <div className={cx('spacer')} />
                 <div className={cx('commit')}>
+                  <span>{build?.author_name}</span>
+                  &nbsp;&nbsp;
                   <strong>
                     <Commit />
-                    {build?.after.slice(0, 8)}
+                    {build?.target}
                   </strong>
                   <span>{(build?.title || build?.message)}</span>
                 </div>
@@ -65,6 +67,7 @@ Repos.propTypes = {
       deploy_to: PropTypes.string,
       title: PropTypes.string,
       message: PropTypes.string,
+      author_name: PropTypes.string,
       after: PropTypes.string,
       ref: PropTypes.string,
       created: PropTypes.number,
diff --git a/src/components/shared/activity/simple.jsx b/src/components/shared/activity/simple.jsx
index 63b24f3..c76f2f0 100644
--- a/src/components/shared/activity/simple.jsx
+++ b/src/components/shared/activity/simple.jsx
@@ -38,7 +38,7 @@ function wrapBuildLink(child, {
   namespace, name, number, deeplink,
 }) {
   return deeplink === true ? (
-    <a href={`/${namespace}/${name}/${number}`}>{child}</a>
+    <a href={`/awecloud/devops/${namespace}/${name}/${number}`}>{child}</a>
   ) : child;
 }
 
diff --git a/src/components/shared/header/header.jsx b/src/components/shared/header/header.jsx
index da82b5b..4a5a963 100644
--- a/src/components/shared/header/header.jsx
+++ b/src/components/shared/header/header.jsx
@@ -10,7 +10,7 @@ const cx = classNames.bind(styles);
 const buildBreadcrumbs = ({ namespace, name, build }) => {
   if (!namespace || !name) return null;
   const repo = !build ? <span>{`${namespace}/${name}`}</span> : (
-    <Link to={`/${namespace}/${name}`}>
+    <Link to={`/awecloud/devops/${namespace}/${name}`}>
       {namespace}
       /
       {name}
@@ -18,7 +18,7 @@ const buildBreadcrumbs = ({ namespace, name, build }) => {
   );
   return (
     <nav className={cx('header-row', 'breadcrumbs')}>
-      <Link to="/">Repositories</Link>
+      <Link to="/awecloud/devops/">Repositories</Link>
       {repo}
       {build && (
         <span>
@@ -51,7 +51,7 @@ const Header = (props) => {
     </div>
   ) : null;
   // back to feed
-  const backToFeed = showBackToFeed ? <Link className={cx('back-to-feed')} to={`/${namespace}/${name}`}>Activity feed</Link> : null;
+  const backToFeed = showBackToFeed ? <Link className={cx('back-to-feed')} to={`/awecloud/devops/${namespace}/${name}`}>Activity feed</Link> : null;
   // heading
   const heading = title ? (
     <h1 className={cx('heading')}>{title}</h1>
diff --git a/src/components/shared/sidebar/sidebar.jsx b/src/components/shared/sidebar/sidebar.jsx
index a272516..9005f93 100644
--- a/src/components/shared/sidebar/sidebar.jsx
+++ b/src/components/shared/sidebar/sidebar.jsx
@@ -17,7 +17,7 @@ import styles from './sidebar.module.scss';
 const cx = classNames.bind(styles);
 
 const Anonymous = () => (
-  <Link className={cx('sidebar-item', 'anonymous')} to="/welcome">
+  <Link className={cx('sidebar-item', 'anonymous')} to="/awecloud/devops/welcome">
     <div role="img" aria-label="Click to sign in">
       <UserIcon />
     </div>
@@ -38,7 +38,7 @@ export default function Sidebar(props) {
     <div className={cx('top')}>
       <Button
         as="link"
-        to="/"
+        to="/awecloud/devops/"
         className={cx('sidebar-item', 'logo')}
       >
         <img src={logo} alt="Drone Logo" />
@@ -61,7 +61,7 @@ export default function Sidebar(props) {
       {isUserAdmin ? (
 
         <NavLink
-          to="/settings"
+          to="/awecloud/devops/settings"
           className={cx('sidebar-item')}
           activeClassName={cx('sidebar-item-active')}
         >
@@ -71,7 +71,7 @@ export default function Sidebar(props) {
       {isUserAuthenticated ? (
         <NavLink
           as="link"
-          to="/account"
+          to="/awecloud/devops/account"
           className={cx('sidebar-item')}
           activeClassName={cx('sidebar-item-active')}
           theme="plain"
diff --git a/src/hooks/swr/builds.js b/src/hooks/swr/builds.js
index c2b8531..a200383 100644
--- a/src/hooks/swr/builds.js
+++ b/src/hooks/swr/builds.js
@@ -18,7 +18,7 @@ const useBuilds = ({ namespace, name }) => {
     if (previousPageData && previousPageData.length < MAX_PAGE_LENGTH) {
       return null;
     }
-    return `/api/repos/${namespace}/${name}/builds?page=${index}&per_page=${MAX_PAGE_LENGTH}`; // SWR key
+    return `/awecloud/devops/api/repos/${namespace}/${name}/builds?page=${index}&per_page=${MAX_PAGE_LENGTH}`; // SWR key
   };
 
   const {
@@ -43,7 +43,7 @@ const useBuilds = ({ namespace, name }) => {
   };
 };
 
-const useBuild = ({ namespace, name, build }) => useSWRBase(`/api/repos/${namespace}/${name}/builds/${build}`);
+const useBuild = ({ namespace, name, build }) => useSWRBase(`/awecloud/devops/api/repos/${namespace}/${name}/builds/${build}`);
 
 /* useStreamBuildEvents helpers */
 
@@ -87,7 +87,7 @@ const updateBuilds = async (slug, repo, newBuild = null) => {
 
   /* @TODO @NOTE
   / There should have been used simple key like
-  / `/api/repos/${namespace}/${name}/builds?page=1',
+  / `/awecloud/devops/api/repos/${namespace}/${name}/builds?page=1',
   / but for some weird reason Builds page won't get its data
   / mutated using cached data stored for that key.
   /
@@ -101,7 +101,7 @@ const updateBuilds = async (slug, repo, newBuild = null) => {
   /
   / probably, it makes sense to use paginated data without useSWR
   */
-  const path = `arg@"many"@"/api/repos${slug}/builds?page=1&per_page=${MAX_PAGE_LENGTH}"`;
+  const path = `arg@"many"@"/awecloud/devops/api/repos${slug}/builds?page=1&per_page=${MAX_PAGE_LENGTH}"`;
   mutateGlobal(path, async (builds) => {
     const build = newBuild ?? repo.build;
     /* if no cache or no data,
@@ -130,14 +130,14 @@ const updateBuilds = async (slug, repo, newBuild = null) => {
 };
 
 const updateBuild = (location, repo) => {
-  const [currentNamespace, currentName, currentBuildNumber] = location.split('/').filter(Boolean);
+  const [currentAwecloud, currentDevops, currentNamespace, currentName, currentBuildNumber] = location.split('/').filter(Boolean);
   const { namespace: eventNamespace, name: eventName, build: { number: eventBuildNumber } } = repo;
   // if current build matches event build params, do mutation
   if (currentNamespace === eventNamespace
       && currentName === eventName
       && +currentBuildNumber === eventBuildNumber
   ) {
-    mutateGlobal(`/api/repos/${eventNamespace}/${eventName}/builds/${eventBuildNumber}`, async () => repo.build, false);
+    mutateGlobal(`/awecloud/devops/api/repos/${eventNamespace}/${eventName}/builds/${eventBuildNumber}`, async () => repo.build, false);
   }
 };
 
@@ -173,12 +173,12 @@ const useStreamBuildEvents = () => {
       default:
     }
 
-    mutateGlobal('/api/user/repos?latest=true', updateLatestRepos(repo), false);
+    mutateGlobal('/awecloud/devops/api/user/repos?latest=true', updateLatestRepos(repo), false);
     update(repo);
   };
 
   useEffect(() => {
-    const path = `${instance}/api/stream${token ? `?access_token=${token}` : ''}`;
+    const path = `${instance}/awecloud/devops/api/stream${token ? `?access_token=${token}` : ''}`;
     const eventSource = new EventSource(path);
     eventSource.onmessage = handleEventSourceMessage;
     eventSource.onerror = forceRerender;
diff --git a/src/hooks/swr/cards.js b/src/hooks/swr/cards.js
index 86df14f..23a1edf 100644
--- a/src/hooks/swr/cards.js
+++ b/src/hooks/swr/cards.js
@@ -2,4 +2,4 @@ import useSWRBase from './use-swr-base';
 
 export const useCard = ({
   namespace, name, build, stage, step,
-}) => useSWRBase(`/api/repos/${namespace}/${name}/cards/${build}/${stage}/${step}`);
+}) => useSWRBase(`/awecloud/devops/api/repos/${namespace}/${name}/cards/${build}/${stage}/${step}`);
diff --git a/src/hooks/swr/logs.js b/src/hooks/swr/logs.js
index d19e1ce..9cbfb35 100644
--- a/src/hooks/swr/logs.js
+++ b/src/hooks/swr/logs.js
@@ -25,7 +25,7 @@ function escapeLogs(logs) {
 const useLogs = (dispatch, actionTypes, {
   namespace, name, build, stage = 1, step = 1,
 }, shouldFetchLogs) => {
-  const { data, error } = useSWR(() => (shouldFetchLogs === true ? `/api/repos/${namespace}/${name}/builds/${build}/logs/${stage}/${step}` : null));
+  const { data, error } = useSWR(() => (shouldFetchLogs === true ? `/awecloud/devops/api/repos/${namespace}/${name}/builds/${build}/logs/${stage}/${step}` : null));
   const formattedLogs = useMemo(() => escapeLogs(data), [data]);
 
   useEffect(() => {
@@ -68,7 +68,7 @@ const useStreamLogs = (dispatch,
       return `${instance}/api/stream/${pathBody}${token ? `?access_token=${token}` : ''}`;
     }
     // make path for mutation
-    return `/api/repos/${pathBody}`;
+    return `/awecloud/devops/api/repos/${pathBody}`;
   }, [shouldStreamLogs, namespace, name, build, stage, step]);
 
   const messageHandler = useCallback((event) => {
diff --git a/src/hooks/swr/repo.js b/src/hooks/swr/repo.js
index b39a1da..e875369 100644
--- a/src/hooks/swr/repo.js
+++ b/src/hooks/swr/repo.js
@@ -1,6 +1,6 @@
 import useSWRBase from './use-swr-base';
 
-const useRepo = ({ namespace, name }) => useSWRBase(`/api/repos/${namespace}/${name}`);
+const useRepo = ({ namespace, name }) => useSWRBase(`/awecloud/devops/api/repos/${namespace}/${name}`);
 
 const useLatestRepos = (shouldFetch = false) => useSWRBase(shouldFetch ? '/api/user/repos?latest=true' : null);
 
diff --git a/src/hooks/swr/use-branches.js b/src/hooks/swr/use-branches.js
index 598f987..eac5966 100644
--- a/src/hooks/swr/use-branches.js
+++ b/src/hooks/swr/use-branches.js
@@ -1,3 +1,3 @@
 import useSWRBase from './use-swr-base';
 
-export default ({ namespace, name }) => useSWRBase(`/api/repos/${namespace}/${name}/builds/branches`);
+export default ({ namespace, name }) => useSWRBase(`/awecloud/devops/api/repos/${namespace}/${name}/builds/branches`);
diff --git a/src/hooks/swr/use-crons.js b/src/hooks/swr/use-crons.js
index 93ac36f..92d0df2 100644
--- a/src/hooks/swr/use-crons.js
+++ b/src/hooks/swr/use-crons.js
@@ -1,3 +1,3 @@
 import useSWRBase from './use-swr-base';
 
-export default ({ namespace, name }) => useSWRBase(`/api/repos/${namespace}/${name}/cron`);
+export default ({ namespace, name }) => useSWRBase(`/awecloud/devops/api/repos/${namespace}/${name}/cron`);
diff --git a/src/hooks/swr/use-deployments.js b/src/hooks/swr/use-deployments.js
index d870990..9467b89 100644
--- a/src/hooks/swr/use-deployments.js
+++ b/src/hooks/swr/use-deployments.js
@@ -1,3 +1,3 @@
 import useSWRBase from './use-swr-base';
 
-export default ({ namespace, name }) => useSWRBase(`/api/repos/${namespace}/${name}/builds/deployments`);
+export default ({ namespace, name }) => useSWRBase(`/awecloud/devops/api/repos/${namespace}/${name}/builds/deployments`);
diff --git a/src/hooks/swr/use-secrets.js b/src/hooks/swr/use-secrets.js
index 3ca8c07..aea5052 100644
--- a/src/hooks/swr/use-secrets.js
+++ b/src/hooks/swr/use-secrets.js
@@ -1,3 +1,3 @@
 import useSWRBase from './use-swr-base';
 
-export default ({ namespace, name }) => useSWRBase(`/api/repos/${namespace}/${name}/secrets`);
+export default ({ namespace, name }) => useSWRBase(`/awecloud/devops/api/repos/${namespace}/${name}/secrets`);
diff --git a/src/pages/account/account.jsx b/src/pages/account/account.jsx
index da8184e..fd4b7c5 100644
--- a/src/pages/account/account.jsx
+++ b/src/pages/account/account.jsx
@@ -75,7 +75,7 @@ export default function Account() {
     <>
       <header className={cx('header')}>
         <h1>Account Settings</h1>
-        <a href="/logout" target="_self">Logout</a>
+        <a href="/awecloud/devops/logout" target="_self">Logout</a>
       </header>
       <section className={cx('wrapper')}>
         {snippets.token.snippet ? (
diff --git a/src/pages/branches/branches.jsx b/src/pages/branches/branches.jsx
index 488ac49..83d7995 100644
--- a/src/pages/branches/branches.jsx
+++ b/src/pages/branches/branches.jsx
@@ -23,7 +23,7 @@ export default function Branches({ repo }) {
   // user can proceed with repo activation
   useLayoutEffect(() => {
     if (!isRepoActive) {
-      history.replace(`/${namespace}/${name}/settings`);
+      history.replace(`/awecloud/devops/${namespace}/${name}/settings`);
     }
   }, [isRepoActive, history, namespace, name]);
 
diff --git a/src/pages/build/build.jsx b/src/pages/build/build.jsx
index 713f246..2abb7dc 100644
--- a/src/pages/build/build.jsx
+++ b/src/pages/build/build.jsx
@@ -118,11 +118,11 @@ export default function Build({ user, userIsAdminOrHasWritePerm }) {
     const encode = encodeURIComponent;
     const queryString = Object.entries(queryParams).map(([key, value]) => `${encode(key)}=${encode(value)}`).join('&');
     try {
-      const res = await axiosWrapper(`${instance}/api/repos/${namespace}/${name}/builds/${build}/${action}?${queryString}`, {
+      const res = await axiosWrapper(`${instance}/awecloud/devops/api/repos/${namespace}/${name}/builds/${build}/${action}?${queryString}`, {
         method: 'POST',
       });
       if (res) {
-        history.push(`/${namespace}/${name}/${res.number}`);
+        history.push(`/awecloud/devops/${namespace}/${name}/${res.number}`);
       } else {
         showError('Unable to create new deploy in this repo');
       }
@@ -135,9 +135,9 @@ export default function Build({ user, userIsAdminOrHasWritePerm }) {
 
   const handleCancelClick = useCallback(async () => {
     try {
-      const res = await axiosWrapper(`/api/repos/${namespace}/${name}/builds/${build}`, { method: 'DELETE' });
+      const res = await axiosWrapper(`/awecloud/devops/api/repos/${namespace}/${name}/builds/${build}`, { method: 'DELETE' });
       await mutate(res, false);
-      history.push(`/${namespace}/${name}/${res.number}`);
+      history.push(`/awecloud/devops/${namespace}/${name}/${res.number}`);
     } catch (e) {
       showError(`Unable to cancel build: ${e.message}`);
       // eslint-disable-next-line
@@ -147,8 +147,8 @@ export default function Build({ user, userIsAdminOrHasWritePerm }) {
 
   const handleRestartClick = useCallback(async () => {
     try {
-      const res = await axiosWrapper(`/api/repos/${namespace}/${name}/builds/${build}`, { method: 'POST' });
-      history.push(`/${namespace}/${name}/${res.number}/1/1`);
+      const res = await axiosWrapper(`/awecloud/devops/api/repos/${namespace}/${name}/builds/${build}`, { method: 'POST' });
+      history.push(`/awecloud/devops/${namespace}/${name}/${res.number}/1/1`);
     } catch (e) {
       showError(`Unable to restart build: ${e.message}`);
       // eslint-disable-next-line
@@ -158,8 +158,8 @@ export default function Build({ user, userIsAdminOrHasWritePerm }) {
 
   const handleDebugClick = useCallback(async () => {
     try {
-      const res = await axiosWrapper(`/api/repos/${namespace}/${name}/builds/${build}?debug=true`, { method: 'POST' });
-      history.push(`/${namespace}/${name}/${res.number}`);
+      const res = await axiosWrapper(`/awecloud/devops/api/repos/${namespace}/${name}/builds/${build}?debug=true`, { method: 'POST' });
+      history.push(`/awecloud/devops/${namespace}/${name}/${res.number}`);
     } catch (e) {
       showError(`Unable to restart in debug mode: ${e.message}`);
       // eslint-disable-next-line
@@ -169,7 +169,7 @@ export default function Build({ user, userIsAdminOrHasWritePerm }) {
 
   const handleApproveClick = useCallback(async () => {
     try {
-      await axiosWrapper(`/api/repos/${namespace}/${name}/builds/${build}/approve/${stage}`, {
+      await axiosWrapper(`/awecloud/devops/api/repos/${namespace}/${name}/builds/${build}/approve/${stage}`, {
         method: 'POST',
       });
       await mutate();
@@ -182,7 +182,7 @@ export default function Build({ user, userIsAdminOrHasWritePerm }) {
 
   const handleDeclineClick = useCallback(async () => {
     try {
-      await axiosWrapper(`/api/repos/${namespace}/${name}/builds/${build}/decline/${stage}`, {
+      await axiosWrapper(`/awecloud/devops/api/repos/${namespace}/${name}/builds/${build}/decline/${stage}`, {
         method: 'POST',
       });
       await mutate();
diff --git a/src/pages/build/header/header.jsx b/src/pages/build/header/header.jsx
index 499a7cc..93f4e72 100644
--- a/src/pages/build/header/header.jsx
+++ b/src/pages/build/header/header.jsx
@@ -68,7 +68,7 @@ const Header = (props) => {
     <header className={cx('header')}>
       <div className={cx('breadcrumbs')}>
         <Breadcrumb className={cx('breadcrumbs-inner')}>
-          <BreadcrumbItem href={`/${namespace}/${name}`} text="Builds" />
+          <BreadcrumbItem href={`/awecloud/devops/${namespace}/${name}`} text="Builds" />
           <BreadcrumbSpacer />
           <BreadcrumbItem text={`#${build}`} />
           <BreadcrumbSpacer />
@@ -115,7 +115,7 @@ const Header = (props) => {
 
       <div className={cx('title')}>
         <h1>
-          <Link to={`/${namespace}/${name}`}>
+          <Link to={`/awecloud/devops/${namespace}/${name}`}>
             <ArrowIcon />
           </Link>
           {name}
diff --git a/src/pages/builds/builds.jsx b/src/pages/builds/builds.jsx
index 5f0e8fa..e220b44 100644
--- a/src/pages/builds/builds.jsx
+++ b/src/pages/builds/builds.jsx
@@ -25,7 +25,7 @@ export default function Builds({ repo }) {
   // user can proceed with repo activation
   useLayoutEffect(() => {
     if (!isRepoActive) {
-      history.replace(`/${namespace}/${name}/settings`);
+      history.replace(`/awecloud/devops/${namespace}/${name}/settings`);
     }
   }, [isRepoActive, history, namespace, name]);
 
diff --git a/src/pages/builds/summary/summary.jsx b/src/pages/builds/summary/summary.jsx
index c75a1f3..9b7a44d 100644
--- a/src/pages/builds/summary/summary.jsx
+++ b/src/pages/builds/summary/summary.jsx
@@ -48,7 +48,7 @@ const Summary = (props) => {
   const { namespace, name } = useParams();
   const history = useHistory();
 
-  const handleBarClick = useCallback(({ number }) => history.push(`/${namespace}/${name}/${number}`), [namespace, name, history]);
+  const handleBarClick = useCallback(({ number }) => history.push(`/awecloud/devops/${namespace}/${name}/${number}`), [namespace, name, history]);
 
   const { median, latest } = useMemo(() => getSummaryMeta(barData), [barData]);
   return (
diff --git a/src/pages/deployments/deployments.jsx b/src/pages/deployments/deployments.jsx
index 1fcfb0c..d86757e 100644
--- a/src/pages/deployments/deployments.jsx
+++ b/src/pages/deployments/deployments.jsx
@@ -22,7 +22,7 @@ export default function Deployments({ repo }) {
   // user can proceed with repo activation
   useLayoutEffect(() => {
     if (!isRepoActive) {
-      history.replace(`/${namespace}/${name}/settings`);
+      history.replace(`/awecloud/devops/${namespace}/${name}/settings`);
     }
   }, [isRepoActive, history, namespace, name]);
 
diff --git a/src/pages/login/login.jsx b/src/pages/login/login.jsx
index f0eb264..a70b99d 100644
--- a/src/pages/login/login.jsx
+++ b/src/pages/login/login.jsx
@@ -29,7 +29,7 @@ export default function LoginForm() {
           <h1 className={cx('title')}>Sign in using your Gogs credentials.</h1>
           <span className={cx('title-sub')}>使用您的Gogs用户名和密码登录</span>
         </div>
-        <Form className={cx('form')} method="POST" action="/login">
+        <Form className={cx('form')} method="POST" action="/awecloud/devops/login">
           <FormSection>
             <Field.Input
               label="Username"
diff --git a/src/pages/not-found/not-found.jsx b/src/pages/not-found/not-found.jsx
index df6af10..06061d1 100644
--- a/src/pages/not-found/not-found.jsx
+++ b/src/pages/not-found/not-found.jsx
@@ -24,7 +24,7 @@ export default function NotFound({ user }) {
         {!user && (
           <Button
             as="link"
-            to="/welcome"
+            to="/awecloud/devops/welcome"
             theme="primary"
             className={cx('btn')}
           >
diff --git a/src/pages/repo/repo.jsx b/src/pages/repo/repo.jsx
index 9505433..8b5a164 100644
--- a/src/pages/repo/repo.jsx
+++ b/src/pages/repo/repo.jsx
@@ -29,25 +29,25 @@ const getTabProps = ({
 }) => {
   const tabs = [
     {
-      to: `/${namespace}/${name}`,
+      to: `/awecloud/devops/${namespace}/${name}`,
       exact: true,
       label: 'Builds',
       tag: isRepoNavDisabled ? 'span' : NavLink,
     },
     {
-      to: `/${namespace}/${name}/branches`,
+      to: `/awecloud/devops/${namespace}/${name}/branches`,
       exact: true,
       label: 'Branches',
       tag: isRepoNavDisabled ? 'span' : NavLink,
     },
     {
-      to: `/${namespace}/${name}/deployments`,
+      to: `/awecloud/devops/${namespace}/${name}/deployments`,
       exact: true,
       label: 'Deployments',
       tag: isRepoNavDisabled ? 'span' : NavLink,
     },
     {
-      to: `/${namespace}/${name}/settings`,
+      to: `/awecloud/devops/${namespace}/${name}/settings`,
       label: 'Settings',
       tag: NavLink,
     },
@@ -107,7 +107,7 @@ const Repo = ({ user }) => {
       values.parameters.forEach((param) => { queryParams.set(param.key, param.value); });
     }
     const queryString = queryParams.toString();
-    const endpoint = `/api/repos/${namespace}/${name}/builds${queryString.length ? `?${queryString}` : ''}`;
+    const endpoint = `/awecloud/devops/api/repos/${namespace}/${name}/builds${queryString.length ? `?${queryString}` : ''}`;
     try {
       const newBuild = await axiosWrapper(endpoint, {
         method: 'POST',
@@ -130,10 +130,10 @@ const Repo = ({ user }) => {
     <Switch>
       <Route
         path={[
-          '/:namespace/:name',
-          '/:namespace/:name/deployments',
-          '/:namespace/:name/branches',
-          '/:namespace/:name/settings*',
+          '/awecloud/devops/:namespace/:name',
+          '/awecloud/devops/:namespace/:name/deployments',
+          '/awecloud/devops/:namespace/:name/branches',
+          '/awecloud/devops/:namespace/:name/settings*',
         ]}
         exact
       >
@@ -141,7 +141,7 @@ const Repo = ({ user }) => {
           <header className={cx('header')}>
             <div className={cx('inner')}>
               <Breadcrumb className={cx('breadcrumb')}>
-                <BreadcrumbItem href="/" text="Repositories" />
+                <BreadcrumbItem href="/awecloud/devops/" text="Repositories" />
                 <BreadcrumbSpacer />
               </Breadcrumb>
               <h1>{name}</h1>
@@ -161,7 +161,7 @@ const Repo = ({ user }) => {
           <Switch>
 
             <Routes.Branches
-              path="/:namespace/:name/branches"
+              path="/awecloud/devops/:namespace/:name/branches"
               componentProps={{
                 user,
                 repo,
@@ -170,7 +170,7 @@ const Repo = ({ user }) => {
               exact
             />
             <Routes.Deployments
-              path="/:namespace/:name/deployments"
+              path="/awecloud/devops/:namespace/:name/deployments"
               componentProps={{
                 user,
                 repo,
@@ -180,7 +180,7 @@ const Repo = ({ user }) => {
             />
             {/* contains nested routes for crons and secrets */}
             <Routes.Settings
-              path="/:namespace/:name/settings*"
+              path="/awecloud/devops/:namespace/:name/settings*"
               componentProps={{
                 user,
                 repo,
@@ -188,7 +188,7 @@ const Repo = ({ user }) => {
               visibility={VISIBILITY_LEVELS.PUBLIC}
             />
             <Routes.Builds
-              path="/:namespace/:name"
+              path="/awecloud/devops/:namespace/:name"
               componentProps={{
                 user,
                 repo,
@@ -207,7 +207,7 @@ const Repo = ({ user }) => {
         </>
       </Route>
       <Routes.Build
-        path="/:namespace/:name/:build/:stage?/:step?"
+        path="/awecloud/devops/:namespace/:name/:build/:stage?/:step?"
         componentProps={{
           user,
           userIsAdminOrHasWritePerm,
diff --git a/src/pages/settings-admin/settings-admin.jsx b/src/pages/settings-admin/settings-admin.jsx
index 9b74aa0..27ad51c 100644
--- a/src/pages/settings-admin/settings-admin.jsx
+++ b/src/pages/settings-admin/settings-admin.jsx
@@ -15,7 +15,7 @@ const cx = classNames.bind(css);
 
 const getTabProps = () => [
   {
-    to: '/settings/users',
+    to: '/awecloud/devops/settings/users',
     exact: true,
     label: 'Users',
   },
@@ -53,12 +53,12 @@ const SettingsAdmin = ({ user }) => {
       {navEl}
       <Switch>
         <Route
-          path="/settings"
-          component={() => <Redirect from="/settings" to="/settings/users" strict exact />}
+          path="/awecloud/devops/settings"
+          component={() => <Redirect from="/awecloud/devops/settings" to="/awecloud/devops/settings/users" strict exact />}
           exact
         />
         <Routes.Users
-          path="/settings/users"
+          path="/awecloud/devops/settings/users"
           componentProps={{
             user,
           }}
diff --git a/src/pages/settings/cron/cron.jsx b/src/pages/settings/cron/cron.jsx
index 36ff38d..ee94b12 100644
--- a/src/pages/settings/cron/cron.jsx
+++ b/src/pages/settings/cron/cron.jsx
@@ -86,7 +86,7 @@ export default function Secrets() {
 
   const handleAddCron = useCallback(async (values) => {
     try {
-      const res = await axiosWrapper(`/api/repos/${namespace}/${name}/cron`, {
+      const res = await axiosWrapper(`/awecloud/devops/api/repos/${namespace}/${name}/cron`, {
         method: 'POST',
         data: { ...values, branch: values.branch || 'master' },
       });
@@ -103,7 +103,7 @@ export default function Secrets() {
     const userAgreed = confirm('Are you sure you want to remove cron job?');
     if (userAgreed) {
       try {
-        await axiosWrapper(`/api/repos/${namespace}/${name}/cron/${cronName}`, { method: 'DELETE' });
+        await axiosWrapper(`/awecloud/devops/api/repos/${namespace}/${name}/cron/${cronName}`, { method: 'DELETE' });
         showSuccess('Cron has been removed successfully');
         mutate(data.filter((cronItem) => cronItem.name !== cronName), false);
       } catch (e) {
diff --git a/src/pages/settings/general/general.jsx b/src/pages/settings/general/general.jsx
index 6ed3124..9a67e55 100644
--- a/src/pages/settings/general/general.jsx
+++ b/src/pages/settings/general/general.jsx
@@ -54,7 +54,7 @@ export default function General({ user, repo }) {
     const userAgreed = confirm('Are you sure you want to disable this repo?');
     if (userAgreed) {
       try {
-        await axiosWrapper(`/api/repos/${namespace}/${name}`, { method: 'DELETE' });
+        await axiosWrapper(`/awecloud/devops/api/repos/${namespace}/${name}`, { method: 'DELETE' });
         mutate();
         showSuccess('Repo has been disabled');
       } catch (e) {
@@ -67,7 +67,7 @@ export default function General({ user, repo }) {
 
   const handleSettingsSubmit = async () => {
     try {
-      const res = await axiosWrapper(`/api/repos/${namespace}/${name}`, { method: 'PATCH', data: { ...settings, timeout: +settings.timeout } });
+      const res = await axiosWrapper(`/awecloud/devops/api/repos/${namespace}/${name}`, { method: 'PATCH', data: { ...settings, timeout: +settings.timeout } });
       mutate(res);
       showSuccess('Changes have been saved');
     } catch (e) {
diff --git a/src/pages/settings/secrets/secrets.jsx b/src/pages/settings/secrets/secrets.jsx
index 42d9ce9..9eb271e 100644
--- a/src/pages/settings/secrets/secrets.jsx
+++ b/src/pages/settings/secrets/secrets.jsx
@@ -22,7 +22,7 @@ export default function Secrets() {
 
   const handleAddSecret = useCallback(async (values) => {
     try {
-      const res = await axiosWrapper(`/api/repos/${namespace}/${name}/secrets`,
+      const res = await axiosWrapper(`/awecloud/devops/api/repos/${namespace}/${name}/secrets`,
         {
           method: 'POST',
           data: values,
@@ -41,7 +41,7 @@ export default function Secrets() {
     const userAgreed = window.confirm('Are you sure you want to delete this secret?');
     if (userAgreed) {
       try {
-        await axiosWrapper(`/api/repos/${namespace}/${name}/secrets/${secretName}`, {
+        await axiosWrapper(`/awecloud/devops/api/repos/${namespace}/${name}/secrets/${secretName}`, {
           method: 'DELETE',
         });
         mutate(data.filter((secretItem) => secretItem.name !== secretName), false);
diff --git a/src/pages/settings/settings.jsx b/src/pages/settings/settings.jsx
index 5a4d737..828425c 100644
--- a/src/pages/settings/settings.jsx
+++ b/src/pages/settings/settings.jsx
@@ -70,7 +70,7 @@ export default function Settings({ user, repo }) {
 
   const handleEnableRepo = useCallback(async () => {
     try {
-      const res = await axiosWrapper(`/api/repos/${namespace}/${name}`, { method: 'POST' });
+      const res = await axiosWrapper(`/awecloud/devops/api/repos/${namespace}/${name}`, { method: 'POST' });
       mutate(res, false);
       showSuccess('Repo has been successfully enabled');
     } catch (e) {
@@ -91,7 +91,7 @@ export default function Settings({ user, repo }) {
               <NavLink
                 className={cx('settings-nav-item')}
                 activeClassName={cx('settings-nav-item-active')}
-                to={`/${namespace}/${name}/settings`}
+                to={`/awecloud/devops/${namespace}/${name}/settings`}
                 exact
               >
                 General
@@ -99,7 +99,7 @@ export default function Settings({ user, repo }) {
               <NavLink
                 className={cx('settings-nav-item')}
                 activeClassName={cx('settings-nav-item-active')}
-                to={`/${namespace}/${name}/settings/secrets`}
+                to={`/awecloud/devops/${namespace}/${name}/settings/secrets`}
                 exact
               >
                 Secrets
@@ -107,7 +107,7 @@ export default function Settings({ user, repo }) {
               <NavLink
                 className={cx('settings-nav-item')}
                 activeClassName={cx('settings-nav-item-active')}
-                to={`/${namespace}/${name}/settings/cron`}
+                to={`/awecloud/devops/${namespace}/${name}/settings/cron`}
                 exact
               >
                 Cron Jobs
@@ -115,7 +115,7 @@ export default function Settings({ user, repo }) {
               <NavLink
                 className={cx('settings-nav-item')}
                 activeClassName={cx('settings-nav-item-active')}
-                to={`/${namespace}/${name}/settings/badges`}
+                to={`/awecloud/devops/${namespace}/${name}/settings/badges`}
                 exact
               >
                 Badges
@@ -124,7 +124,7 @@ export default function Settings({ user, repo }) {
               <NavLink
                 className={cx('settings-nav-item')}
                 activeClassName={cx('settings-nav-item-active')}
-                to={`/${namespace}/${name}/settings/org-secrets`}
+                to={`/awecloud/devops/${namespace}/${name}/settings/org-secrets`}
                 exact
               >
                 Secrets
@@ -132,7 +132,7 @@ export default function Settings({ user, repo }) {
               <NavLink
                 className={cx('settings-nav-item')}
                 activeClassName={cx('settings-nav-item-active')}
-                to={`/${namespace}/${name}/settings/templates`}
+                to={`/awecloud/devops/${namespace}/${name}/settings/templates`}
                 exact
               >
                 Templates
@@ -141,15 +141,15 @@ export default function Settings({ user, repo }) {
           </aside>
           <Switch>
             <Route
-              path="/:namespace/:name/settings"
+              path="/awecloud/devops/:namespace/:name/settings"
               component={GeneralCallback}
               exact
             />
-            <Route path="/:namespace/:name/settings/secrets" component={Secrets} />
-            <Route path="/:namespace/:name/settings/cron" component={Cron} />
-            <Route path="/:namespace/:name/settings/badges" component={Badges} />
-            <Route path="/:namespace/:name/settings/org-secrets" component={OrgSecrets} />
-            <Route path="/:namespace/:name/settings/templates" component={Templates} />
+            <Route path="/awecloud/devops/:namespace/:name/settings/secrets" component={Secrets} />
+            <Route path="/awecloud/devops/:namespace/:name/settings/cron" component={Cron} />
+            <Route path="/awecloud/devops/:namespace/:name/settings/badges" component={Badges} />
+            <Route path="/awecloud/devops/:namespace/:name/settings/org-secrets" component={OrgSecrets} />
+            <Route path="/awecloud/devops/:namespace/:name/settings/templates" component={Templates} />
 
           </Switch>
         </section>
diff --git a/src/pages/welcome/welcome.jsx b/src/pages/welcome/welcome.jsx
index b2e679f..946ce31 100644
--- a/src/pages/welcome/welcome.jsx
+++ b/src/pages/welcome/welcome.jsx
@@ -25,10 +25,10 @@ export default function Welcome() {
   const { pathname, search } = useLocation();
   let error = null;
   switch (pathname) {
-    case '/logout':
+    case '/awecloud/devops/logout':
       error = <div className={cx('error')}>Your session has been successfully terminated.</div>;
       break;
-    case '/login/error':
+    case '/awecloud/devops/login/error':
       if (window.location.host === 'cloud.drone.io') {
         // special case for cloud.drone.io
         error = (
@@ -68,7 +68,7 @@ export default function Welcome() {
           {error}
           <p>You will be redirected to your source control management system to authenticate.</p>
         </div>
-        <a href="/login" target="_self" className={cx('btn')}>
+        <a href="/awecloud/devops/login" target="_self" className={cx('btn')}>
           <span>Continue</span>
           <ChevronDownIcon className={cx('chevron-right')} />
         </a>
diff --git a/src/routes/route-guard.jsx b/src/routes/route-guard.jsx
index 9e50938..586a240 100644
--- a/src/routes/route-guard.jsx
+++ b/src/routes/route-guard.jsx
@@ -30,7 +30,7 @@ export default function RouteGuard(props) {
     ].some((cond) => !!cond)) return route;
 
   if (visibility !== VISIBILITY_LEVELS.PUBLIC && isUserAuthenticated === false) {
-    return <Redirect to="/welcome" />;
+    return <Redirect to="/awecloud/devops/welcome" />;
   }
   return <NotFound user={user} />;
 }
-- 
2.39.2

